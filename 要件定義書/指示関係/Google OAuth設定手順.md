# Google OAuth 2.0 クライアントID作成手順

## 前提条件
- Googleアカウント（Ghouse-development@gmail.comなど）
- ブラウザ

## 手順1: Google Cloud Consoleにアクセス

1. ブラウザで以下のURLを開く
   ```
   https://console.cloud.google.com/
   ```

2. Googleアカウントでログイン
   - アカウント: Ghouse-development
   - パスワード: Ghouse0648

## 手順2: プロジェクトの作成（既存プロジェクトがない場合）

1. 画面上部の「プロジェクトを選択」をクリック
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を入力
   - 例: `nandemo-project` または `ghouse-vc`
4. 「作成」ボタンをクリック
5. プロジェクトが作成されるまで待つ（数秒）
6. 作成されたプロジェクトを選択

## 手順3: OAuth同意画面の設定

### 3-1. APIとサービスに移動

1. 左側のハンバーガーメニュー（≡）をクリック
2. 「APIとサービス」にマウスを当てる
3. 「OAuth同意画面」をクリック

### 3-2. ユーザータイプの選択

1. 「外部」を選択（個人用の場合）
2. 「作成」ボタンをクリック

### 3-3. OAuth同意画面の情報入力

**アプリ情報**
- アプリ名: `GハウスVC加盟店管理システム`（任意の名前）
- ユーザーサポートメール: 自分のメールアドレスを選択

**アプリのドメイン**（スキップ可能）
- ホームページ: （空欄でOK）

**デベロッパーの連絡先情報**
- メールアドレス: 自分のメールアドレスを入力

「保存して次へ」をクリック

### 3-4. スコープ（権限）の設定

1. 「スコープを追加または削除」をクリック
2. 以下のスコープにチェック:
   - `email`
   - `profile`
   - `openid`
3. 「更新」をクリック
4. 「保存して次へ」をクリック

### 3-5. テストユーザーの追加（開発中のみ）

1. 「ADD USERS」をクリック
2. テストユーザーのメールアドレスを入力
   - 例: あなたのメールアドレス
3. 「追加」をクリック
4. 「保存して次へ」をクリック

### 3-6. 確認

1. 内容を確認
2. 「ダッシュボードに戻る」をクリック

## 手順4: OAuth 2.0 クライアントIDの作成

### 4-1. 認証情報画面に移動

1. 左側のメニューで「認証情報」をクリック
2. 画面上部の「+ 認証情報を作成」をクリック
3. 「OAuth クライアント ID」を選択

### 4-2. アプリケーションの種類を選択

1. アプリケーションの種類: 「ウェブ アプリケーション」を選択
2. 名前: `GハウスVC Web Client`（任意の名前）

### 4-3. 承認済みのリダイレクトURIを設定

**⚠️ 重要: 2つの項目があるので注意**
- **承認済みの JavaScript 生成元**: ここには入力しない（またはドメインのみ）
- **承認済みのリダイレクト URI**: ここに入力する（パスを含むURL）

**開発環境用**
1. 画面を下にスクロール
2. 「承認済みのリダイレクト URI」セクションを見つける
   - **注意**: 「承認済みの JavaScript 生成元」ではありません
3. 「承認済みのリダイレクト URI」の「+ URIを追加」をクリック
4. 以下のURLを**正確に**入力:
   ```
   https://twzsirpfudqwboeyakta.supabase.co/auth/v1/callback
   ```
   - 末尾に「/」を付けないこと
   - コピー＆ペーストを推奨

**ローカル開発用（オプション）**
5. もう一度「+ URIを追加」をクリック
6. 以下のURLを追加:
   ```
   http://localhost:3456/auth/callback
   ```

### 4-4. クライアントIDの作成

1. 「作成」ボタンをクリック
2. ポップアップが表示されます

**重要: この情報をコピーして保存**
- **クライアント ID**: `xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com`
- **クライアント シークレット**: `GOCSPX-xxxxxxxxxxxxxxxxxxxx`

3. 「OK」をクリック

## 手順5: SupabaseにOAuth設定を追加

### 5-1. Supabaseダッシュボードを開く

1. ブラウザで以下のURLを開く
   ```
   https://twzsirpfudqwboeyakta.supabase.co
   ```

### 5-2. Authentication設定に移動

1. 左側のメニューで「Authentication」をクリック
2. 「Providers」タブをクリック

### 5-3. Google Providerを有効化

1. プロバイダー一覧から「Google」を探す
2. 「Google Enabled」トグルをONにする

### 5-4. Google認証情報を入力

1. **Client ID（for OAuth）**: Google Cloud ConsoleでコピーしたクライアントIDを貼り付け
2. **Client Secret（for OAuth）**: クライアントシークレットを貼り付け

### 5-5. Redirect URLを確認

Supabaseが自動的に表示するRedirect URLをメモ:
```
https://twzsirpfudqwboeyakta.supabase.co/auth/v1/callback
```

このURLがGoogle Cloud Consoleの「承認済みのリダイレクトURI」に登録されていることを確認

### 5-6. 保存

1. 画面下部の「Save」ボタンをクリック

## 手順6: 動作確認

### 6-1. アプリケーションを起動

```bash
cd meetingbrain-mvp
npm run dev
```

### 6-2. ログインページにアクセス

1. ブラウザで `http://localhost:3456/login` を開く
2. 「Googleでログイン」ボタンをクリック
3. Googleのログイン画面が表示される
4. アカウントを選択してログイン
5. 初回は同意画面が表示される → 「許可」をクリック
6. ログイン成功後、`/library` ページにリダイレクトされる

## トラブルシューティング

### エラー: "redirect_uri_mismatch"
→ Google Cloud Consoleの「承認済みのリダイレクトURI」が正しく設定されていません
→ 手順4-3を再確認

### エラー: "Access blocked: This app's request is invalid"
→ OAuth同意画面が正しく設定されていません
→ 手順3を再確認

### Google OAuth同意画面が表示されない
→ ブラウザのポップアップブロッカーを無効化してください

### ログインできるが、すぐにログアウトされる
→ ドメイン制限（g-house.co.jp）により、他のドメインのメールアドレスはログインできません
→ テスト用に一時的にドメイン制限を無効化するか、g-house.co.jpのメールアドレスを使用してください

## 本番環境への移行

### Vercelにデプロイした場合

1. Google Cloud Consoleに戻る
2. 「認証情報」→作成したOAuthクライアントを選択
3. 「承認済みのリダイレクトURI」に本番URLを追加:
   ```
   https://your-app.vercel.app/auth/callback
   ```
4. 「保存」をクリック

## セキュリティのベストプラクティス

1. **クライアントシークレットは絶対に公開しない**
   - GitHubにコミットしない
   - 環境変数として管理する

2. **承認済みのリダイレクトURIを限定する**
   - 必要なURLのみ追加
   - ワイルドカード（*）は使用しない

3. **OAuth同意画面を適切に設定**
   - 明確なアプリ名と説明
   - プライバシーポリシーと利用規約のURLを追加（本番環境）

---

**作成日**: 2025年10月26日
**最終更新**: 2025年10月26日
