# 設計・IC業務統合管理システム

住宅案件管理とメール発注業務を統合した、設計士・インテリアコーディネーター向けの業務効率化システムです。

## 🎯 主な機能

### 1. 案件管理
- 設計士ごとのタブで案件を整理
- 各案件の進捗管理（16種類のタスク）
- リアルタイム進捗率表示
- 検索・フィルタリング機能

### 2. メールテンプレート管理
- テンプレートの追加・編集・削除
- カテゴリ別管理（設計/IC）
- 変数置換機能

### 3. タスク-テンプレート紐づけ設定
- 各タスクに対してメールテンプレートを設定
- ワンクリックでメール作成可能に

### 4. ワンクリックメール作成 ⭐新機能
- タスクカードの「📧」ボタンをクリック
- 顧客名、期日などを自動入力
- 件名・宛先・本文をワンクリックでコピー

## 🚀 セットアップ手順

### ステップ1: Supabaseテーブル作成

1. Supabaseダッシュボードにアクセス
   ```
   https://twzsirpfudqwboeyakta.supabase.co
   ```

2. 左メニューから「SQL Editor」を開く

3. `supabase_setup.sql` の内容をコピー&ペーストして実行

4. `supabase_seed_data.sql` の内容をコピー&ペーストして実行（初期データ投入）

### ステップ2: アプリケーション起動

1. `index.html` をブラウザで開く

2. 初回アクセス時、データが自動的に読み込まれます

## 📖 使い方

### 案件を追加する

1. **📋 案件管理**タブを開く
2. 右上の「案件追加」ボタンをクリック
3. 以下の情報を入力：
   - お客様名（必須）
   - 担当設計士（必須）
   - 仕様（LIFE、LIFE+、HOURS等）
   - メモ（任意）
4. 「保存」をクリック

### タスクの進捗を更新する

1. 案件カード内のチェックボックスをクリック
2. 自動的にSupabaseに保存されます
3. 進捗率が自動計算されます

### タスクからメールを作成する

#### 事前準備（初回のみ）

1. **🔗 タスク設定**タブを開く
2. 各タスクに対してメールテンプレートを選択
   - 例: 「給排水」→「給排水設備業者（給排水設備図面）」
   - 例: 「換気」→「パナソニックリビング近畿（換気図面）」
3. 「設定を保存」をクリック

#### メール作成手順

1. **📋 案件管理**タブで案件カードを表示
2. タスク項目の右側にある「📧」ボタンをクリック
3. 必要に応じて以下を編集：
   - 担当者名（署名用）
   - 期日
   - 内容詳細（任意）
4. 「メールを生成」をクリック
5. 件名・宛先・本文が自動生成されます
6. 各「コピー」ボタンでクリップボードにコピー
7. メールクライアントに貼り付けて送信

### メールテンプレートを追加する

1. **📧 メールテンプレート**タブを開く
2. 「テンプレート追加」ボタンをクリック
3. 以下の情報を入力：
   - テンプレートID（英数字、例: new-template）
   - 表示名
   - カテゴリ（設計 or IC）
   - 会社名
   - 宛先名
   - メールアドレス
   - 件名フォーマット
   - メール本文テンプレート
4. 「保存」をクリック

### 使用できる変数

メールテンプレートで以下の変数が使用できます：

- `{customerName}` - 顧客名
- `{dueDate}` - 期日
- `{staffName}` - 担当者名（署名用）
- `{company}` - 会社名
- `{contact}` - 宛先名
- `{specialContent}` - 内容詳細

**例:**
```
{company}
{contact}

いつもお世話になっております。
新規換気図面作成お願いいたします。

【お客様名】　{customerName}
【　期日　】　{dueDate}
```

### 設計士を追加する

1. **📋 案件管理**タブで「設計士管理」ボタンをクリック
2. 設計士名を入力
3. 「追加」をクリック
4. 自動的にタブに表示されます

## 📋 タスク一覧

以下の16種類のタスクを管理できます：

1. 0回目打合せ
2. 間取り確定
3. 初回準備
4. 確定図面
5. チェックリスト
6. 実施図依頼
7. **給排水** 📧
8. **換気** 📧
9. **太陽光** 📧
10. **エボルツ** 📧
11. **サッシ依頼** 📧
12. **構造依頼** 📧
13. **地盤調査** 📧
14. **申請依頼** 📧
15. **外構依頼** 📧
16. **ダンドリUP** 📧

**📧マーク**: メールテンプレートを設定すると「📧」ボタンが表示されます

## 💡 活用のヒント

### 1. タスクの期日を設定する
- タスクにチェックを入れると自動的に今日の日付が記録されます
- 期日を編集したい場合は、タスク名をクリック

### 2. 検索機能を活用
- 顧客名やメモ内容で絞り込み可能
- 仕様でフィルタリング可能

### 3. 並び替えオプション
- 手動並び替え
- 進捗が低い順
- 更新が新しい順
- 顧客名順

### 4. メールテンプレートのカテゴリ分け
- **設計**: 換気、給排水、サッシ、太陽光など
- **IC**: 照明プラン、建具プレゼン、設備PBなど

### 5. テンプレートの変数活用
- `{staffName}` で担当者名を署名に自動挿入
- `{dueDate}` で期日を自動挿入
- `{specialContent}` で詳細内容を柔軟に記述

## 🔧 データベース構造

### テーブル一覧

1. **designers** - 設計士情報
2. **projects** - 案件情報
3. **email_templates** - メールテンプレート
4. **template_vendors** - テンプレート業者情報（サブオプション）
5. **task_template_mappings** - タスクとテンプレートの紐づけ

### データの永続化

- 全てのデータはSupabaseに自動保存されます
- ブラウザを閉じても データは保持されます
- 複数のデバイスから同じデータにアクセス可能

## ⚠️ 注意事項

### データの安全性
- 定期的にバックアップを推奨します
- Supabaseダッシュボードから手動でエクスポート可能

### ブラウザ互換性
- Chrome、Edge、Safari、Firefox（最新版）で動作確認済み
- インターネット接続が必要です

### 同時編集
- 複数ユーザーが同時にアクセス可能
- ただし、同じ案件を同時に編集すると競合する可能性があります
- 保存時に最新のデータで上書きされます

## 🆘 トラブルシューティング

### データが表示されない

1. ブラウザのコンソールを開く（F12キー）
2. エラーメッセージを確認
3. Supabaseの接続情報が正しいか確認
4. テーブルが正しく作成されているか確認

### メール作成ボタン（📧）が表示されない

1. **🔗 タスク設定**タブを開く
2. 該当タスクにメールテンプレートを設定
3. 「設定を保存」をクリック
4. **📋 案件管理**タブに戻ると表示されます

### 保存が失敗する

1. インターネット接続を確認
2. Supabaseのステータスを確認
3. ブラウザのキャッシュをクリア
4. ページを再読み込み

## 📞 サポート

問題が解決しない場合は、以下の情報を添えてお問い合わせください：

1. ブラウザの種類とバージョン
2. エラーメッセージ（あれば）
3. 操作手順

---

**バージョン**: 1.0.0
**作成日**: 2025年1月
**対応ブラウザ**: Chrome, Edge, Safari, Firefox（最新版）
